<html>
    <div id="notAnalysedView" style="display:none">
        <div style="display: flex;flex-direction: row;justify-content: center;width: 100%">
            <div style="display: flex;flex-direction: column;justify-content: center;height: 100%">
                <h2> You have to analyse the url before you can see the rusults </h1>
                <div style="display: flex;flex-direction: row;justify-content: center;width: 100%">
                    <a href="/">Analyse URL now</a>
                </div>
            </div>
        </div>
    </div>
    <div id="stillAnalysingView" style="display:none">
        <div style="display: flex;flex-direction: row;justify-content: center;width: 100%">
            <div style="display: flex;flex-direction: column;justify-content: center;height: 100%">
                <h2> We are still analysing the Webpage </h1>
                <div style="display: flex;flex-direction: row;justify-content: center;width: 100%">
                    <h2>Now analysing Page:&nbsp;</h2>
                    <h2 id="alread_analysed">0</h2>
                    <h2>&nbsp;of&nbsp;20&nbsp;Pages</h2>
                </div>
            </div>
        </div>
    </div>
    <div id="resultsView" style="display:none">
        <div style="display: flex;flex-direction: row;justify-content: center;width: 100%">
            <div style="display: flex;flex-direction: column;justify-content: center;height: 100%">
                <h2> We are still analysing the Webpage </h1>
                <div style="display: flex;flex-direction: row;justify-content: center;width: 100%">
                    <h2>Now analysing Page:&nbsp;</h2>
                    <h2 id="alread_analysed">0</h2>
                    <h2>&nbsp;of&nbsp;20&nbsp;Pages</h2>
                </div>
            </div>
        </div>
    </div>
</html>

<script>
let url = "{$url}"

function makeRequest(){
    const xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/results");
    xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhttp.send(JSON.stringify({"url":url})); 
    xhttp.onreadystatechange = () => {
        if (xhttp.readyState === 4) {
            result_callback(JSON.parse(xhttp.response));
        }
    }
}

function result_callback(data){
    if(data.type=="ERROR"){
        if(data.data == "not_analysed"){
            document.getElementById("notAnalysedView").style="display:unset"
            return
        }
        if(data.data == "still_analysing"){
            document.getElementById("stillAnalysingView").style="display:unset"
            document.getElementById("alread_analysed").innerHTML=data.info_data.visited_pages
            setTimeout(makeRequest, 500);
            return
        }
    }
    //WE HAVE A SUCCES
    document.getElementById("stillAnalysingView").style="display:none"
    view_Success(data.data)
}

function view_Success(data){
    
}

makeRequest()

</script>